{
  "variables": {
    "do_api_key": "{{env `DIGITALOCEAN_API_KEY`}}",
    "do_client_id": "{{env `DIGITALOCEAN_CLIENT_ID`}}"
  },
  "provisioners": [
    {
      "type": "shell",
      "inline": [
          "sudo yum install gcc python-devel python-crypto python-pip -y",
          "sudo pip install ansible",
          "mkdir -p /tmp/ansible-local"
      ]
    },
    {
      "type": "file",
      "source": "../provision",
      "destination": "/tmp/ansible-local"
    },
    {
      "type": "ansible-local",
      "playbook_file": "../provision/stage.yml",
      "role_paths": [
          "../provision/roles"
      ],
      "staging_directory": "/tmp/ansible-local"
    }
  ],
  "builders": [
    {
      "type": "digitalocean",
      "api_key": "{{ user `do_api_key` }}",
      "client_id": "{{ user `do_client_id` }}",
      "region_id": 6,
      "image_id": 1646467,
      "size_id": 66,
      "snapshot_name": "common"
    }
  ]
}
